<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ Thống Quản Lý Học Tập</title>
    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen" class="login-wrapper">
        <div class="login-card">
            <div class="login-header">
                <img src="logo1.png" alt="Logo">
                <h2>Đăng nhập hệ thống</h2>
            </div>
            <form id="login-form">
                <div class="form-group">
                    <label for="username">Tên đăng nhập hoặc Email</label>
                    <input type="text" id="username" placeholder="Nhập username hoặc email" required>
                </div>
                <div class="form-group">
                    <label for="password">Mật khẩu</label>
                    <input type="password" id="password" placeholder="Nhập mật khẩu" required>
                </div>
                <button type="submit" class="btn btn-primary btn-block">Đăng nhập</button>
            </form>
            <div style="text-align: center; margin-top: 15px;">
                <p>Chưa có tài khoản? <a href="#" onclick="showRegister()" style="color: var(--primary); font-weight: 600;">Đăng ký ngay</a></p>
            </div>
        </div>
    </div>

    <!-- Register Screen -->
    <div id="register-screen" class="login-wrapper" style="display: none;">
        <div class="login-card" style="max-width: 500px;">
            <div class="login-header">
                <img src="logo1.png" alt="Logo">
                <h2 id="register-title">Đăng ký tài khoản</h2>
            </div>
            
            <!-- Step 1: Account Info -->
            <div id="reg-step-1">
                <form id="register-form-step-1">
                    <div class="form-group">
                        <label for="reg-email">Email (Dùng để đăng nhập) *</label>
                        <input type="email" id="reg-email" placeholder="example@student.com" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-password">Mật khẩu *</label>
                        <input type="password" id="reg-password" placeholder="Mật khẩu" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block" style="margin-top: 15px;">Đăng ký</button>
                </form>
            </div>

            <!-- Step 2: Personal Info -->
            <div id="reg-step-2" style="display: none;">
                <form id="register-form-step-2">
                    <div class="form-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div class="form-group">
                            <label for="reg-msv">Mã sinh viên (MSV) *</label>
                            <input type="text" id="reg-msv" placeholder="VD: 211200001" required>
                        </div>
                        <div class="form-group">
                            <label for="reg-gmail">Email đăng ký</label>
                            <input type="email" id="reg-gmail" readonly style="background: #f5f5f5;">
                        </div>
                        <div class="form-group" style="grid-column: span 2;">
                            <label for="reg-name">Họ và tên *</label>
                            <input type="text" id="reg-name" placeholder="Nhập tên" required>
                        </div>
                        <div class="form-group">
                            <label for="reg-gender">Giới tính</label>
                            <select id="reg-gender">
                                <option value="Nam">Nam</option>
                                <option value="Nữ">Nữ</option>
                                <option value="Khác">Khác</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="reg-dob">Ngày sinh</label>
                            <input type="date" id="reg-dob">
                        </div>
                        <div class="form-group">
                            <label for="reg-cohort">Khóa (VD: K25)</label>
                            <input type="text" id="reg-cohort" placeholder="K25">
                        </div>
                        <div class="form-group" style="grid-column: span 2;">
                            <label for="reg-class">Lớp (VD: CNTT1)</label>
                            <input type="text" id="reg-class" placeholder="CNTT1">
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button type="button" id="reg-back-btn" class="btn btn-secondary btn-block" onclick="showRegStep(1)">Quay lại</button>
                        <button type="submit" class="btn btn-primary btn-block">Hoàn tất đăng ký</button>
                    </div>
                </form>
            </div>

            <div style="text-align: center; margin-top: 15px;">
                <p>Đã có tài khoản? <a href="#" onclick="showLogin()" style="color: var(--primary); font-weight: 600;">Quay lại đăng nhập</a></p>
            </div>
        </div>
    </div>

    <div id="app-container" style="display: none;">
        <div class="container main-layout">
            <div class="sidebar">
                <div class="sidebar-logo">
                    <img src="logo1.png" alt="Logo">
                    <h2>PKA System</h2>
                </div>
                <div class="nav">
                    <div class="nav-section common-view">
                        <div class="nav-section-title"><i class="fas fa-info-circle" style="margin-right: 8px;"></i> Thông tin chung</div>
                        <button class="nav-btn admin-only" onclick="showPage('general-info')">Trường thành viên</button>
                        <button class="nav-btn student-only faculty-only" onclick="showPage('general-info-view')">Trường thành viên</button>
                        <button class="nav-btn common-view" onclick="showPage('faculties_mgmt')">Khoa</button>
                        <button class="nav-btn common-view" onclick="showPage('majors_mgmt')">Ngành học</button>
                    </div>

                    <div class="nav-section admin-faculty-only">
                        <div class="nav-section-title admin-faculty-only"><i class="fas fa-tasks" style="margin-right: 8px;"></i> Quản lý đào tạo</div>
                        <button class="nav-btn admin-only" onclick="showPage('courses')">Quản lý học phần</button>
                        <button class="nav-btn admin-faculty-only" onclick="showPage('students')">Sinh viên</button>
                        <button class="nav-btn faculty-only" onclick="showPage('grades')">Quản lý điểm</button>
                    </div>

                    <div class="nav-section student-only">
                        <div class="nav-section-title"><i class="fas fa-graduation-cap" style="margin-right: 8px;"></i> Góc học tập</div>
                        <button class="nav-btn student-only" onclick="showPage('enrollment')">Đăng ký học phần</button>
                        <button class="nav-btn student-only" onclick="showPage('student-grades')">Kết quả học tập</button>
                    </div>

                    <div class="nav-section student-only">
                        <div class="nav-section-title"><i class="fas fa-hands-helping" style="margin-right: 8px;"></i> Hỗ trợ học tập</div>
                        <button class="nav-btn student-only" onclick="showPage('grade-calc')">Công cụ tính điểm</button>
                        <button class="nav-btn student-only" onclick="showPage('support-student')">Hỗ trợ sinh viên</button>
                    </div>
                </div>
            </div>

            <div class="main-content">
                <div class="header">
                    <h1>Hệ thống quản lý học tập </h1>
                    <div id="user-info-header" style="margin-left: auto; display: flex; align-items: center; gap: 20px;">
                        <div class="notification-wrapper common-view" style="position: relative; cursor: pointer;" onclick="toggleNotificationBox()">
                            <i class="fas fa-bell" style="font-size: 1.25rem; color: var(--text-secondary);"></i>
                            <span id="unread-count" class="badge-count" style="display: none;">0</span>
                        </div>
                        <span id="display-user-name" style="font-weight: 600;"></span>
                        <button class="btn btn-secondary btn-sm" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i> Đăng xuất
                        </button>
                    </div>

                    <!-- Notification Box -->
                    <div id="notification-box" class="notification-dropdown">
                        <div class="notif-header">
                            <h3>Thông báo</h3>
                            <button class="btn-close-notif" onclick="toggleNotificationBox()">×</button>
                        </div>
                        <div id="notif-list" class="notif-content">
                            <p class="text-center-muted" style="padding: 20px;">Không có thông báo mới</p>
                        </div>
                    </div>
                </div>

                <!-- Content -->
                <div class="content">
            <!-- General Info Page -->
            <div id="general-info" class="page">
                <div style="margin-bottom: 20px;" class="admin-only">
                    <button class="btn btn-primary" onclick="openAddSchoolModal()">+ Thêm thông tin</button>
                </div>
                <!-- School Info Section -->
                <div id="school-info-section" style="margin-bottom: 30px;">
                    <!-- Populated by JS -->
                    <p class="text-center-muted" style="padding: 20px;">Đang tải thông tin trường...</p>
                </div>
            </div>

            <!-- Faculty Management Page -->
            <div id="faculties_mgmt" class="page">
                <h2 class="page-header-title">Quản lý khoa</h2>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <button class="btn btn-primary admin-only" onclick="openAddFacultyModal()">+ Thêm khoa</button>
                    <div class="search-container" style="display: flex; gap: 10px;">
                        <select id="filterSchool" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px;" onchange="filterFacultiesBySchool()">
                            <option value="">-- Tất cả trường --</option>
                        </select>
                        <select id="filterColumnFaculty" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
                            <option value="all">Tất cả</option>
                            <option value="id">Mã khoa</option>
                            <option value="name">Tên khoa</option>
                            <option value="address">Địa chỉ</option>
                        </select>
                        <input type="text" id="searchFaculty" placeholder="Tìm kiếm khoa..." onkeyup="searchFaculties()" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; width: 300px;">
                    </div>
                </div>
                <div id="facultyGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
                    <!-- Content will be rendered by JS -->
                    <p class="text-center-muted" style="grid-column: 1/-1;">Chưa có dữ liệu</p>
                </div>
            </div>

            <!-- Major Management Page -->
            <div id="majors_mgmt" class="page">
                <h2 class="page-header-title">Quản lý ngành học</h2>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary admin-only" onclick="openAddMajorModal()">+ Thêm ngành học</button>
                    </div>
                    <div class="search-container" style="display: flex; gap: 10px;">
                        <select id="filterColumnMajor" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
                            <option value="all">Tất cả</option>
                            <option value="id">Mã ngành</option>
                            <option value="name">Tên ngành</option>
                            <option value="faculty">Khoa</option>
                        </select>
                         <input type="text" id="searchMajor" placeholder="Tìm kiếm ngành học..." onkeyup="searchMajors()" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; width: 300px;">
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Mã ngành</th>
                                <th>Tên ngành</th>
                                <th>Số tín chỉ</th>
                                <th>Trường thành viên</th>
                                <th>Khoa</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody id="majorTableBody">
                            <tr>
                                <td colspan="5" class="text-center-muted">Chưa có dữ liệu</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

            </div>

            <!-- Students Page -->
            <div id="students" class="page">
                <h2 class="page-header-title">Quản lý sinh viên</h2>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <button class="btn btn-primary admin-only" onclick="openAddStudentModal()">+ Thêm sinh viên</button>
                    <div class="search-container" style="display: flex; gap: 10px;">
                        <select id="filterColumnStudent" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
                            <option value="all">Tất cả</option>
                            <option value="id">Mã SV</option>
                            <option value="name">Tên SV</option>
                            <option value="class">Lớp</option>
                            <option value="email">Email</option>
                        </select>
                        <input type="text" id="searchStudent" placeholder="Tìm kiếm sinh viên..." onkeyup="searchStudents()" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; width: 300px;">
                    </div>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Mã SV</th>
                                <th>Họ và tên</th>
                                <th>Email</th>
                                <th>Giới tính</th>
                                <th>Ngày sinh</th>
                                <th>Lớp</th>
                                <th>Khóa</th>
                                <th id="studentActionHeader">Thao tác</th>
                            </tr>
                        </thead>
                        <tbody id="studentTableBody">
                            <tr>
                                <td colspan="7" class="text-center-muted">Chưa có dữ liệu</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Courses Page -->
            <div id="courses" class="page">
                <h2 class="page-header-title">Quản lý học phần</h2>
                
                 <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <button class="btn btn-primary admin-only" onclick="openCourseModal()">+ Thêm học phần</button>
                    <div class="search-container" style="display: flex; gap: 10px;">
                         <select id="filterColumnCourse" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
                            <option value="all">Tất cả</option>
                            <option value="id">Mã HP</option>
                            <option value="name">Tên HP</option>
                        </select>
                        <input type="text" id="searchCourse" placeholder="Tìm kiếm học phần..." onkeyup="searchCourses()" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; width: 300px;">
                    </div>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Mã HP</th>
                                <th>Tên học phần</th>
                                <th>Tổng tín chỉ</th>
                                <th>Tín chỉ lý thuyết</th>
                                <th>Tín chỉ thực hành</th>
                                <th>Học phần tiên quyết</th>
                                <th>Học phần song hành</th>
                                <th>Học phần học trước</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody id="courseTableBody">
                            <tr>
                                <td colspan="9" class="text-center-muted">Chưa có dữ liệu</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Enrollment Page Removed -->

            <!-- Grades Page -->
            <div id="grades" class="page">
                <h2 class="page-header-title">Quản lý điểm</h2>

                 <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <button class="btn btn-primary admin-faculty-only" onclick="openGradeModal()">+ Thêm điểm</button>
                    <div class="search-container" style="display: flex; gap: 10px;">
                        <select id="filterGradeByCourse" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px;" onchange="searchGrades()">
                            <option value="">-- Tất cả học phần --</option>
                        </select>
                        <select id="filterColumnGrade" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
                            <option value="all">Tất cả</option>
                            <option value="studentId">Mã SV</option>
                        </select>
                        <input type="text" id="searchGrade" placeholder="Tìm kiếm sinh viên..." onkeyup="searchGrades()" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; width: 300px;">
                    </div>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Mã SV</th>
                                <th>Tên SV</th>
                                <th>Điểm chuyên cần 1</th>
                                <th>Điểm chuyên cần 2</th>
                                <th>Điểm giữa kỳ</th>
                                <th>Điểm cuối kỳ</th>
                                <th>Điểm TB</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody id="gradeTableBody">
                            <tr>
                                <td colspan="8" class="text-center-muted">Chưa có dữ liệu</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Common Info View -->
            <div id="general-info-view" class="page">
                <h2 class="page-header-title">Trường thành viên</h2>
                <div id="school-info-section-view" style="margin-bottom: 30px;">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Enrollment Page -->
            <div id="enrollment" class="page">
                <h2 class="page-header-title">Đăng ký học phần</h2>
                
                <div id="enrollment-stats" style="display: flex; gap: 20px; align-items: center; margin-bottom: 20px; background: #f0f7ff; padding: 15px; border-radius: 8px; border-left: 4px solid var(--primary);">
                    <div style="font-size: 1rem;">Số lớp đã đăng ký: <strong id="enrolled-classes-count" style="color: var(--primary);">0</strong></div>
                    <div style="font-size: 1rem;">Tổng số tín chỉ: <strong id="enrolled-credits-sum" style="color: var(--primary);">0</strong></div>
                    <button class="btn btn-secondary btn-sm" onclick="showEnrolledDetails()" style="margin-left: auto;">Xem chi tiết</button>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Mã HP</th>
                                <th>Tên học phần</th>
                                <th>Số tín chỉ</th>
                                <th>Trạng thái</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody id="enrollmentTableBody">
                            <tr>
                                <td colspan="5" class="text-center-muted">Đang tải dữ liệu...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Student Grades Page -->
            <div id="student-grades" class="page">
                <h2 class="page-header-title">Kết quả học tập</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Mã HP</th>
                                <th>Tên học phần</th>
                                <th>Số TC</th>
                                <th>Điểm CC1</th>
                                <th>Điểm CC2</th>
                                <th>Điểm GK</th>
                                <th>Điểm CK</th>
                                <th>Điểm TB</th>
                                <th>Xếp loại</th>
                            </tr>
                        </thead>
                        <tbody id="studentGradesTableBody">
                            <tr>
                                <td colspan="9" class="text-center-muted">Đang tải dữ liệu...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Grade Calculator Page -->
            <div id="grade-calc" class="page">
                <h2 class="page-header-title">Công cụ tính điểm</h2>
                
                <!-- Component Grade Calculator -->
                <div class="card" style="padding: 20px; background: white; border-radius: 8px; box-shadow: var(--shadow-sm); margin-bottom: 30px;">
                    <h3>Tính điểm học phần dự kiến</h3>
                    <p style="margin-bottom: 20px; font-size: 0.9rem; color: #666;">Tính điểm tổng kết môn học từ các điểm thành phần.</p>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Cách tính điểm (Trọng số)</label>
                            <select id="calcWeightMethod" class="modal-input" style="width: 100%;" onchange="updateWeightLabels()">
                                <option value="5-5-40-50">5% - 5% - 40% - 50% (CC1 - CC2 - GK - CK)</option>
                                <option value="5-5-30-60">5% - 5% - 30% - 60% (CC1 - CC2 - GK - CK)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label id="lblScore1">Điểm chuyên cần 1</label>
                            <input type="number" id="calcScore1" placeholder="0-10" step="0.1" class="modal-input">
                        </div>
                        <div class="form-group">
                            <label id="lblScore2">Điểm chuyên cần 2</label>
                            <input type="number" id="calcScore2" placeholder="0-10" step="0.1" class="modal-input">
                        </div>
                        <div class="form-group">
                            <label id="lblScore3">Điểm giữa kỳ</label>
                            <input type="number" id="calcScore3" placeholder="0-10" step="0.1" class="modal-input">
                        </div>
                        <div class="form-group">
                            <label id="lblScore4">Điểm cuối kỳ</label>
                            <input type="number" id="calcScore4" placeholder="0-10" step="0.1" class="modal-input">
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary" onclick="calculateComponentGrade()">Tính điểm môn học</button>
                    </div>
                    <div id="component-calc-result" style="margin-top: 25px; padding: 15px; background: #eff6ff; border-radius: 6px; display: none; border-left: 4px solid var(--primary);">
                        <!-- Course Result -->
                    </div>
                </div>
            </div>

            <!-- Support Student Page -->
            <div id="support-student" class="page">
                <h2 class="page-header-title">Hỗ trợ sinh viên</h2>
                <div class="card" style="padding: 20px; background: white; border-radius: 8px; box-shadow: var(--shadow-sm);">
                    <h3>Liên hệ hỗ trợ</h3>
                    <p style="margin-bottom: 20px; color: #666;">Chọn kênh hỗ trợ bạn cần:</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div style="padding: 20px; border: 1px solid #eee; border-radius: 8px; text-align: center;">
                            <i class="fas fa-envelope" style="font-size: 2rem; color: var(--primary); margin-bottom: 10px;"></i>
                            <h4>Email hỗ trợ</h4>
                            <p>support@student.edu.vn</p>
                        </div>
                        <div style="padding: 20px; border: 1px solid #eee; border-radius: 8px; text-align: center;">
                            <i class="fas fa-phone-alt" style="font-size: 2rem; color: var(--secondary); margin-bottom: 10px;"></i>
                            <h4>Hotline</h4>
                            <p>1900 1234</p>
                        </div>
                        <div style="padding: 20px; border: 1px solid #eee; border-radius: 8px; text-align: center;">
                            <i class="fab fa-facebook-messenger" style="font-size: 2rem; color: #0084ff; margin-bottom: 10px;"></i>
                            <h4>Messenger</h4>
                            <p>fb.com/pkasupport</p>
                        </div>
                    </div>
                </div>
            </div>
        </div> <!-- End of content -->
    </div> <!-- End of main-content -->
</div> <!-- End of app-container -->

    <!-- Add Major Modal -->
    <div id="majorModal" class="modal">
        <div class="modal-content" style="display: flex; flex-direction: column; max-height: 90vh;">
            <span class="close-btn" onclick="closeMajorModal()">&times;</span>
            <h2 style="margin-bottom: 20px; color: var(--primary);">Thêm ngành học mới</h2>
            <div style="overflow-y: auto; flex: 1; padding-right: 10px;">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Mã ngành *</label>
                        <input type="number" id="majorId" placeholder="VD: 1">
                    </div>
                    <div class="form-group">
                        <label>Tên ngành *</label>
                        <input type="text" id="majorName" placeholder="Tên ngành học">
                    </div>
                    <div class="form-group">
                        <label>Khoa</label>
                        <select id="majorFacId">
                            <option value="">-- Chọn khoa --</option>
                        </select>
                    </div>
                </div>

                <!-- Knowledge Blocks Section -->
                <h3 style="font-size: 1.1rem; margin-bottom: 15px; color: var(--primary); margin-top: 20px;">Khối kiến thức</h3>
                <div id="majorKnowledgeBlocksSection" style="border-top: 1px solid #eee; padding-top: 15px;">
                    <div id="majorKnowledgeBlocks">
                        <!-- Knowledge block tabs will be generated here -->
                    </div>
                </div>
            </div>

            <div style="margin-top: 25px; text-align: right; border-top: 1px solid #eee; padding-top: 15px; flex-shrink: 0;">
                <button class="btn btn-secondary" onclick="closeMajorModal()">Hủy bỏ</button>
                <button class="btn btn-primary" onclick="addMajor()">Lưu ngành học</button>
            </div>
        </div>
    </div>

    <!-- Add Student Modal -->
    <div id="studentModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeStudentModal()">&times;</span>
            <h2 style="margin-bottom: 20px; color: var(--primary);">Thêm sinh viên mới</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>Mã sinh viên *</label>
                    <input type="text" id="studentId" placeholder="VD: SV001">
                </div>
                <div class="form-group">
                    <label>Họ và tên *</label>
                    <input type="text" id="studentName" placeholder="Nhập họ tên">
                </div>
                <div class="form-group">
                    <label>Ngày sinh</label>
                    <input type="date" id="studentDob">
                </div>
                <div class="form-group">
                    <label>Giới tính</label>
                    <select id="studentGender">
                        <option value="">-- Chọn giới tính --</option>
                        <option value="Nam">Nam</option>
                        <option value="Nữ">Nữ</option>
                        <option value="Khác">Khác</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Khóa</label>
                    <input type="number" id="studentCohort" placeholder="VD: 2021">
                </div>
                <div class="form-group">
                    <label>Lớp</label>
                    <input type="text" id="studentClass" placeholder="VD: CNTT-K62">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="studentEmail" placeholder="student@example.com">
                </div>
            </div>
            <div style="margin-top: 25px; text-align: right;">
                <button class="btn btn-secondary" onclick="closeStudentModal()">Hủy bỏ</button>
                <button class="btn btn-primary" onclick="addStudent()">Lưu thông tin</button>
            </div>
        </div>
    </div>

    <!-- Add School Modal -->
    <div id="schoolModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeSchoolModal()">&times;</span>
            <h2 style="margin-bottom: 20px; color: var(--primary);">Thêm thông tin trường</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>Mã trường *</label>
                    <input type="number" id="schoolId" placeholder="VD: 1">
                </div>
                <div class="form-group">
                    <label>Tên trường *</label>
                    <input type="text" id="schoolName" placeholder="Tên trường ĐH">
                </div>
                <div class="form-group">
                    <label>Website</label>
                    <input type="text" id="schoolWebsite" placeholder="https://example.edu.vn">
                </div>
            </div>
            <div style="margin-top: 25px; text-align: right;">
                <button class="btn btn-secondary" onclick="closeSchoolModal()">Hủy bỏ</button>
                <button class="btn btn-primary" onclick="addSchool()">Lưu thông tin</button>
            </div>
        </div>
    </div>

    <!-- School Details Modal -->
    <div id="schoolDetailModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeSchoolDetailModal()">&times;</span>
            <h2 id="detailSchoolName" style="margin-bottom: 20px; color: var(--primary);">Chi tiết trường</h2>
            <div id="schoolFacultiesList">
                <p>Đang tải dữ liệu...</p>
            </div>
            <div style="margin-top: 25px; text-align: right;">
                <button class="btn btn-secondary" onclick="closeSchoolDetailModal()">Đóng</button>
            </div>
        </div>
    </div>

    <!-- Add Course Modal -->
    <div id="courseModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeCourseModal()">&times;</span>
            <h2 style="margin-bottom: 20px; color: var(--primary);">Thêm học phần mới</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>Mã học phần *</label>
                    <input type="number" id="courseId" placeholder="VD: 101">
                </div>
                <div class="form-group">
                    <label>Tên học phần *</label>
                    <input type="text" id="courseName" placeholder="Nhập tên học phần">
                </div>
                <div class="form-group">
                    <label>Tổng tín chỉ (Tự động)</label>
                    <input type="number" id="courseCredits" placeholder="0" readonly style="background-color: #f0f0f0;">
                </div>
                <div class="form-group">
                    <label>Tín chỉ lý thuyết</label>
                    <input type="number" id="theoryCredits" placeholder="VD: 2" oninput="calculateTotalCredits()">
                </div>
                <div class="form-group">
                    <label>Tín chỉ thực hành</label>
                    <input type="number" id="practicalCredits" placeholder="VD: 1" oninput="calculateTotalCredits()">
                </div>
                <div class="form-group">
                    <label>Học phần tiên quyết</label>
                    <select id="prerequisite" class="modal-input" style="width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box;">
                        <option value="">-- Không có --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Học phần song hành</label>
                    <select id="coRequisite" class="modal-input" style="width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box;">
                        <option value="">-- Không có --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Học phần học trước</label>
                    <select id="previousCourse" class="modal-input" style="width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box;">
                        <option value="">-- Không có --</option>
                    </select>
                </div>
            </div>
            <div style="margin-top: 25px; text-align: right;">
                <button class="btn btn-secondary" onclick="closeCourseModal()">Hủy bỏ</button>
                <button class="btn btn-primary" onclick="addCourse()">Thêm học phần</button>
            </div>
        </div>
    </div>

    <!-- Add Enrollment Modal Removed -->

    <!-- Add Grade Modal -->
    <div id="gradeModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeGradeModal()">&times;</span>
            <h2 style="margin-bottom: 20px; color: var(--primary);">Thêm/Sửa điểm</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>Mã học phần *</label>
                    <select id="gradeCourseId" class="modal-input" style="width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box;" onchange="onGradeCourseChange()">
                        <option value="">-- Chọn học phần --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Mã sinh viên *</label>
                    <select id="gradeStudentId" class="modal-input" style="width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box;">
                        <option value="">-- Chọn sinh viên --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Điểm chuyên cần 1</label>
                    <input type="number" id="gradeAttendance1" placeholder="0-10" step="0.1" min="0" max="10">
                </div>
                <div class="form-group">
                    <label>Điểm chuyên cần 2</label>
                    <input type="number" id="gradeAttendance2" placeholder="0-10" step="0.1" min="0" max="10">
                </div>
                <div class="form-group">
                    <label>Điểm giữa kỳ</label>
                    <input type="number" id="gradeMidterm" placeholder="0-10" step="0.1" min="0" max="10">
                </div>
                <div class="form-group">
                    <label>Điểm cuối kỳ</label>
                    <input type="number" id="gradeFinal" placeholder="0-10" step="0.1" min="0" max="10">
                </div>
            </div>
            <div style="margin-top: 25px; text-align: right;">
                <button class="btn btn-secondary" onclick="closeGradeModal()">Hủy bỏ</button>
                <button class="btn btn-primary" onclick="addGrade()">Lưu điểm</button>
            </div>
        </div>
    </div>

    <!-- Add Faculty Modal -->
    <div id="facultyModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeFacultyModal()">&times;</span>
            <h2 style="margin-bottom: 20px; color: var(--primary);">Thêm khoa mới</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>Mã Khoa (ID) *</label>
                    <input type="text" id="facultyId" placeholder="Nhập ID">
                </div>
                <div class="form-group">
                    <label>Tên Khoa *</label>
                    <input type="text" id="facultyName" placeholder="Nhập tên khoa">
                </div>
                <div class="form-group">
                    <label>Địa chỉ</label>
                    <input type="text" id="facultyAddress" placeholder="Nhập địa chỉ">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="facultyEmail" placeholder="Nhập email">
                </div>
                <div class="form-group">
                    <label>Số điện thoại</label>
                    <input type="text" id="facultyPhone" placeholder="Nhập SĐT">
                </div>
                <div class="form-group">
                    <label>Trường (Trực thuộc)</label>
                    <select id="facultySchoolId" class="modal-input" style="width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box;">
                        <option value="">-- Không có (Khoa riêng biệt) --</option>
                    </select>
                </div>
            </div>
            <div style="margin-top: 25px; text-align: right;">
                <button class="btn btn-secondary" onclick="closeFacultyModal()">Hủy bỏ</button>
                <button class="btn btn-primary" onclick="addFaculty()">Lưu thông tin</button>
            </div>
        </div>
    </div>

    <!-- Major Detail Modal -->
    <div id="majorDetailModal" class="modal">
        <div class="modal-content" style="max-width: 900px; max-height: 85vh; overflow-y: auto;">
            <span class="close-btn" onclick="closeMajorDetailModal()">&times;</span>
            <h2 id="majorDetailTitle" style="color: var(--primary); margin-bottom: 20px;">Chi tiết ngành học</h2>
            
            <div id="majorInfoSummary" style="background: #f0f7ff; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid var(--primary);">
                <!-- Detailed major info will go here -->
            </div>

            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="color: var(--primary); margin: 0;">Cấu trúc chương trình học</h3>
                <div style="font-size: 1.1rem; font-weight: bold;">
                    Tổng số tín chỉ: <span id="totalCreditsDisplayModal" style="color: var(--primary);">0</span>
                </div>
            </div>
            
            <div id="knowledgeBlocksContainerModal" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px;">
                <!-- Knowledge blocks will be rendered here -->
            </div>

            <div style="margin-top: 25px; text-align: right; border-top: 1px solid #eee; padding-top: 15px;">
                <button class="btn btn-secondary" onclick="closeMajorDetailModal()">Đóng</button>
            </div>
        </div>
    </div>

    <!-- Enrolled Details Modal -->
    <div id="enrolledDetailsModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close-btn" onclick="closeEnrolledDetailsModal()">&times;</span>
            <h2 style="margin-bottom: 20px; color: var(--primary);">Học phần đã đăng ký</h2>
            <div class="table-container">
                <table style="width: 100%;">
                    <thead>
                        <tr>
                            <th>Mã HP</th>
                            <th>Tên học phần</th>
                            <th>Tín chỉ</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody id="enrolledCoursesTableBody">
                        <!-- Data will be inserted here -->
                    </tbody>
                </table>
            </div>
            <div style="margin-top: 25px; text-align: right;">
                <button class="btn btn-secondary" onclick="closeEnrolledDetailsModal()">Đóng</button>
            </div>
        </div>
    </div>

    <!-- Generic Confirm Modal -->
    <div id="confirmModal" class="modal" style="z-index: 2000;">
        <div class="modal-content" style="max-width: 450px; text-align: center; padding: 30px;">
            <i class="fas fa-question-circle" style="font-size: 3rem; color: var(--primary); margin-bottom: 20px;"></i>
            <h2 id="confirmTitle" style="color: var(--primary); margin-bottom: 15px;">Xác nhận</h2>
            <p id="confirmMessage" style="margin-bottom: 25px; font-size: 1.1rem; line-height: 1.5;"></p>
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button class="btn btn-secondary" onclick="closeConfirmModal(false)" style="flex: 1; padding: 12px;">Hủy bỏ</button>
                <button id="confirmOkBtn" class="btn btn-primary" style="flex: 1; padding: 12px;">Xác nhận</button>
            </div>
        </div>
    </div>

    <div id="toast"></div>
    <script src="script.js"></script>
</body>
</html>