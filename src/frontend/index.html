<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ Thống Quản Lý Học Tập</title>
    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="logo1.png" alt="">
            <h1>Hệ thống quản lý học tập </h1>
        </div>

        <div class="nav">
            <button class="nav-btn active" onclick="showPage('general-info')">Trường thành viên</button>
            <button class="nav-btn" onclick="showPage('faculties_mgmt')">Quản lý khoa</button>
            <button class="nav-btn" onclick="showPage('majors_mgmt')">Quản lý ngành học</button>
            <button class="nav-btn" onclick="showPage('courses')">Quản lý học phần</button>
            <button class="nav-btn" onclick="showPage('students')">Quản lý sinh viên</button>
            <button class="nav-btn" onclick="showPage('grades')">Quản lý điểm</button>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- General Info Page -->
            <div id="general-info" class="page active">
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="openAddSchoolModal()">+ Thêm thông tin</button>
                </div>
                <!-- School Info Section -->
                <div id="school-info-section" style="margin-bottom: 30px;">
                    <!-- Populated by JS -->
                    <p class="text-center-muted" style="padding: 20px;">Đang tải thông tin trường...</p>
                </div>
            </div>

            <!-- Faculty Management Page -->
            <div id="faculties_mgmt" class="page">
                <h2 class="page-header-title">Quản lý khoa</h2>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="openAddFacultyModal()">+ Thêm khoa</button>
                    <div class="search-container" style="display: flex; gap: 10px;">
                        <select id="filterSchool" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px;" onchange="filterFacultiesBySchool()">
                            <option value="">-- Tất cả trường --</option>
                        </select>
                        <select id="filterColumnFaculty" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
                            <option value="all">Tất cả</option>
                            <option value="id">Mã khoa</option>
                            <option value="name">Tên khoa</option>
                            <option value="address">Địa chỉ</option>
                        </select>
                        <input type="text" id="searchFaculty" placeholder="Tìm kiếm khoa..." onkeyup="searchFaculties()" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; width: 300px;">
                    </div>
                </div>
                <div id="facultyGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
                    <!-- Content will be rendered by JS -->
                    <p class="text-center-muted" style="grid-column: 1/-1;">Chưa có dữ liệu</p>
                </div>
            </div>

            <!-- Major Management Page -->
            <div id="majors_mgmt" class="page">
                <h2 class="page-header-title">Quản lý ngành học</h2>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="openAddMajorModal()">+ Thêm ngành học</button>
                    <div class="search-container" style="display: flex; gap: 10px;">
                        <select id="filterColumnMajor" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
                            <option value="all">Tất cả</option>
                            <option value="id">Mã ngành</option>
                            <option value="name">Tên ngành</option>
                            <option value="faculty">Khoa</option>
                        </select>
                         <input type="text" id="searchMajor" placeholder="Tìm kiếm ngành học..." onkeyup="searchMajors()" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; width: 300px;">
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Mã ngành</th>
                                <th>Tên ngành</th>
                                <th>Số tín chỉ</th>
                                <th>Khoa</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody id="majorTableBody">
                            <tr>
                                <td colspan="5" class="text-center-muted">Chưa có dữ liệu</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

            </div>

            <!-- Students Page -->
            <div id="students" class="page">
                <h2 class="page-header-title">Quản lý sinh viên</h2>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="openAddStudentModal()">+ Thêm sinh viên</button>
                    <div class="search-container" style="display: flex; gap: 10px;">
                        <select id="filterColumnStudent" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
                            <option value="all">Tất cả</option>
                            <option value="id">Mã SV</option>
                            <option value="name">Tên SV</option>
                            <option value="class">Lớp</option>
                            <option value="email">Email</option>
                        </select>
                        <input type="text" id="searchStudent" placeholder="Tìm kiếm sinh viên..." onkeyup="searchStudents()" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; width: 300px;">
                    </div>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Mã SV</th>
                                <th>Họ và tên</th>
                                <th>Email</th>
                                <th>Giới tính</th>
                                <th>Ngày sinh</th>
                                <th>Lớp</th>
                                <th>Khóa</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody id="studentTableBody">
                            <tr>
                                <td colspan="7" class="text-center-muted">Chưa có dữ liệu</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Courses Page -->
            <div id="courses" class="page">
                <h2 class="page-header-title">Quản lý học phần</h2>
                
                 <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="openCourseModal()">+ Thêm học phần</button>
                    <div class="search-container" style="display: flex; gap: 10px;">
                         <select id="filterColumnCourse" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
                            <option value="all">Tất cả</option>
                            <option value="id">Mã HP</option>
                            <option value="name">Tên HP</option>
                        </select>
                        <input type="text" id="searchCourse" placeholder="Tìm kiếm học phần..." onkeyup="searchCourses()" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; width: 300px;">
                    </div>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Mã HP</th>
                                <th>Tên học phần</th>
                                <th>Tổng tín chỉ</th>
                                <th>Tín chỉ lý thuyết</th>
                                <th>Tín chỉ thực hành</th>
                                <th>Học phần tiên quyết</th>
                                <th>Học phần song hành</th>
                                <th>Học phần học trước</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody id="courseTableBody">
                            <tr>
                                <td colspan="9" class="text-center-muted">Chưa có dữ liệu</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Enrollment Page Removed -->

            <!-- Grades Page -->
            <div id="grades" class="page">
                <h2 class="page-header-title">Quản lý điểm</h2>

                 <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="openGradeModal()">+ Thêm điểm</button>
                    <div class="search-container" style="display: flex; gap: 10px;">
                        <select id="filterColumnGrade" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
                            <option value="all">Tất cả</option>
                            <option value="studentId">Mã SV</option>
                            <option value="courseId">Mã HP</option>
                        </select>
                        <input type="text" id="searchGrade" placeholder="Tìm kiếm điểm..." onkeyup="searchGrades()" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; width: 300px;">
                    </div>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Mã SV</th>
                                <th>Tên SV</th>
                                <th>Mã HP</th>
                                <th>Tên HP</th>
                                <th>Điểm chuyên cần 1</th>
                                <th>Điểm chuyên cần 2</th>
                                <th>Điểm giữa kỳ</th>
                                <th>Điểm cuối kỳ</th>
                                <th>Điểm TB</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody id="gradeTableBody">
                            <tr>
                                <td colspan="10" class="text-center-muted">Chưa có dữ liệu</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Major Modal -->
    <div id="majorModal" class="modal">
        <div class="modal-content" style="display: flex; flex-direction: column; max-height: 90vh;">
            <span class="close-btn" onclick="closeMajorModal()">&times;</span>
            <h2 style="margin-bottom: 20px; color: var(--primary);">Thêm ngành học mới</h2>
            <div style="overflow-y: auto; flex: 1; padding-right: 10px;">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Mã ngành *</label>
                        <input type="number" id="majorId" placeholder="VD: 1">
                    </div>
                    <div class="form-group">
                        <label>Tên ngành *</label>
                        <input type="text" id="majorName" placeholder="Tên ngành học">
                    </div>
                    <div class="form-group">
                        <label>Khoa</label>
                        <select id="majorFacId">
                            <option value="">-- Chọn khoa --</option>
                        </select>
                    </div>
                </div>

                <!-- Knowledge Blocks Section -->
                <h3 style="font-size: 1.1rem; margin-bottom: 15px; color: var(--primary); margin-top: 20px;">Khối kiến thức</h3>
                <div id="majorKnowledgeBlocksSection" style="border-top: 1px solid #eee; padding-top: 15px;">
                    <div id="majorKnowledgeBlocks">
                        <!-- Knowledge block tabs will be generated here -->
                    </div>
                </div>
            </div>

            <div style="margin-top: 25px; text-align: right; border-top: 1px solid #eee; padding-top: 15px; flex-shrink: 0;">
                <button class="btn btn-secondary" onclick="closeMajorModal()">Hủy bỏ</button>
                <button class="btn btn-primary" onclick="addMajor()">Lưu ngành học</button>
            </div>
        </div>
    </div>

    <!-- Add Student Modal -->
    <div id="studentModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeStudentModal()">&times;</span>
            <h2 style="margin-bottom: 20px; color: var(--primary);">Thêm sinh viên mới</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>Mã sinh viên *</label>
                    <input type="text" id="studentId" placeholder="VD: SV001">
                </div>
                <div class="form-group">
                    <label>Họ và tên *</label>
                    <input type="text" id="studentName" placeholder="Nhập họ tên">
                </div>
                <div class="form-group">
                    <label>Ngày sinh</label>
                    <input type="date" id="studentDob">
                </div>
                <div class="form-group">
                    <label>Giới tính</label>
                    <select id="studentGender">
                        <option value="">-- Chọn giới tính --</option>
                        <option value="Nam">Nam</option>
                        <option value="Nữ">Nữ</option>
                        <option value="Khác">Khác</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Khóa</label>
                    <input type="number" id="studentCohort" placeholder="VD: 2021">
                </div>
                <div class="form-group">
                    <label>Lớp</label>
                    <input type="text" id="studentClass" placeholder="VD: CNTT-K62">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="studentEmail" placeholder="student@example.com">
                </div>
            </div>
            <div style="margin-top: 25px; text-align: right;">
                <button class="btn btn-secondary" onclick="closeStudentModal()">Hủy bỏ</button>
                <button class="btn btn-primary" onclick="addStudent()">Lưu thông tin</button>
            </div>
        </div>
    </div>

    <!-- Add School Modal -->
    <div id="schoolModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeSchoolModal()">&times;</span>
            <h2 style="margin-bottom: 20px; color: var(--primary);">Thêm thông tin trường</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>Mã trường *</label>
                    <input type="number" id="schoolId" placeholder="VD: 1">
                </div>
                <div class="form-group">
                    <label>Tên trường *</label>
                    <input type="text" id="schoolName" placeholder="Tên trường ĐH">
                </div>
                <div class="form-group">
                    <label>Website</label>
                    <input type="text" id="schoolWebsite" placeholder="https://example.edu.vn">
                </div>
            </div>
            <div style="margin-top: 25px; text-align: right;">
                <button class="btn btn-secondary" onclick="closeSchoolModal()">Hủy bỏ</button>
                <button class="btn btn-primary" onclick="addSchool()">Lưu thông tin</button>
            </div>
        </div>
    </div>

    <!-- School Details Modal -->
    <div id="schoolDetailModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeSchoolDetailModal()">&times;</span>
            <h2 id="detailSchoolName" style="margin-bottom: 20px; color: var(--primary);">Chi tiết trường</h2>
            <div id="schoolFacultiesList">
                <p>Đang tải dữ liệu...</p>
            </div>
            <div style="margin-top: 25px; text-align: right;">
                <button class="btn btn-secondary" onclick="closeSchoolDetailModal()">Đóng</button>
            </div>
        </div>
    </div>

    <!-- Add Course Modal -->
    <div id="courseModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeCourseModal()">&times;</span>
            <h2 style="margin-bottom: 20px; color: var(--primary);">Thêm học phần mới</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>Mã học phần *</label>
                    <input type="number" id="courseId" placeholder="VD: 101">
                </div>
                <div class="form-group">
                    <label>Tên học phần *</label>
                    <input type="text" id="courseName" placeholder="Nhập tên học phần">
                </div>
                <div class="form-group">
                    <label>Tổng tín chỉ (Tự động)</label>
                    <input type="number" id="courseCredits" placeholder="0" readonly style="background-color: #f0f0f0;">
                </div>
                <div class="form-group">
                    <label>Tín chỉ lý thuyết</label>
                    <input type="number" id="theoryCredits" placeholder="VD: 2" oninput="calculateTotalCredits()">
                </div>
                <div class="form-group">
                    <label>Tín chỉ thực hành</label>
                    <input type="number" id="practicalCredits" placeholder="VD: 1" oninput="calculateTotalCredits()">
                </div>
                <div class="form-group">
                    <label>Học phần tiên quyết</label>
                    <select id="prerequisite" class="modal-input" style="width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box;">
                        <option value="">-- Không có --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Học phần song hành</label>
                    <select id="coRequisite" class="modal-input" style="width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box;">
                        <option value="">-- Không có --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Học phần học trước</label>
                    <select id="previousCourse" class="modal-input" style="width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box;">
                        <option value="">-- Không có --</option>
                    </select>
                </div>
            </div>
            <div style="margin-top: 25px; text-align: right;">
                <button class="btn btn-secondary" onclick="closeCourseModal()">Hủy bỏ</button>
                <button class="btn btn-primary" onclick="addCourse()">Thêm học phần</button>
            </div>
        </div>
    </div>

    <!-- Add Enrollment Modal Removed -->

    <!-- Add Grade Modal -->
    <div id="gradeModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeGradeModal()">&times;</span>
            <h2 style="margin-bottom: 20px; color: var(--primary);">Thêm/Sửa điểm</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>Mã sinh viên *</label>
                    <input type="text" id="gradeStudentId" placeholder="Nhập mã SV">
                </div>
                <div class="form-group">
                    <label>Mã học phần *</label>
                    <input type="text" id="gradeCourseId" placeholder="Nhập mã HP">
                </div>
                <div class="form-group">
                    <label>Điểm chuyên cần 1</label>
                    <input type="number" id="attendance1Score" placeholder="0-10" step="0.1" min="0" max="10">
                </div>
                <div class="form-group">
                    <label>Điểm chuyên cần 2</label>
                    <input type="number" id="attendance2Score" placeholder="0-10" step="0.1" min="0" max="10">
                </div>
                <div class="form-group">
                    <label>Điểm giữa kỳ</label>
                    <input type="number" id="midtermScore" placeholder="0-10" step="0.1" min="0" max="10">
                </div>
                <div class="form-group">
                    <label>Điểm cuối kỳ</label>
                    <input type="number" id="finalScore" placeholder="0-10" step="0.1" min="0" max="10">
                </div>
            </div>
            <div style="margin-top: 25px; text-align: right;">
                <button class="btn btn-secondary" onclick="closeGradeModal()">Hủy bỏ</button>
                <button class="btn btn-primary" onclick="addGrade()">Lưu điểm</button>
            </div>
        </div>
    </div>

    <!-- Add Course to Knowledge Block Modal -->
    <div id="courseToBlockModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeCourseToBlockModal()">&times;</span>
            <h2 style="margin-bottom: 20px; color: var(--primary);">Thêm học phần vào khối kiến thức</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>Ngành học *</label>
                    <select id="blockMajorId" style="padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                        <option value="">-- Chọn ngành học --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Khối kiến thức *</label>
                    <select id="blockType" style="padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                        <option value="">-- Chọn khối kiến thức --</option>
                        <option value="cso_nganh">Khối kiến thức cơ sở ngành</option>
                        <option value="bo_tro">Khối kiến thức bổ trợ</option>
                        <option value="giao_duc_dai_cuong">Khối kiến thức giáo dục đại cương</option>
                        <option value="chuyen_nganh">Khối kiến thức chuyên ngành</option>
                        <option value="thuc_tap">Khối thực tập</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Mã học phần *</label>
                    <input type="text" id="blockCourseId" placeholder="Nhập mã học phần">
                </div>
                <div class="form-group">
                    <label>Tên học phần *</label>
                    <input type="text" id="blockCourseName" placeholder="Nhập tên học phần">
                </div>
                <div class="form-group">
                    <label>Tín chỉ</label>
                    <input type="number" id="blockCourseCredits" placeholder="Nhập số tín chỉ" min="0">
                </div>
            </div>
            <div style="margin-top: 25px; text-align: right;">
                <button class="btn btn-secondary" onclick="closeCourseToBlockModal()">Hủy bỏ</button>
                <button class="btn btn-primary" onclick="addCourseToBlock()">Thêm học phần</button>
            </div>
        </div>
    </div>

    <!-- Add Faculty Modal -->
    <div id="facultyModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeFacultyModal()">&times;</span>
            <h2 style="margin-bottom: 20px; color: var(--primary);">Thêm khoa mới</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>Mã Khoa (ID) *</label>
                    <input type="text" id="facultyId" placeholder="Nhập ID">
                </div>
                <div class="form-group">
                    <label>Tên Khoa *</label>
                    <input type="text" id="facultyName" placeholder="Nhập tên khoa">
                </div>
                <div class="form-group">
                    <label>Địa chỉ</label>
                    <input type="text" id="facultyAddress" placeholder="Nhập địa chỉ">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="facultyEmail" placeholder="Nhập email">
                </div>
                <div class="form-group">
                    <label>Số điện thoại</label>
                    <input type="text" id="facultyPhone" placeholder="Nhập SĐT">
                </div>
                <div class="form-group">
                    <label>Trường (School)</label>
                    <select id="facultySchoolId" class="modal-input" style="width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box;">
                        <option value="">-- Chọn Trường --</option>
                    </select>
                </div>
            </div>
            <div style="margin-top: 25px; text-align: right;">
                <button class="btn btn-secondary" onclick="closeFacultyModal()">Hủy bỏ</button>
                <button class="btn btn-primary" onclick="addFaculty()">Lưu thông tin</button>
            </div>
        </div>
    </div>

    <!-- Major Detail Modal -->
    <div id="majorDetailModal" class="modal">
        <div class="modal-content" style="max-width: 900px; max-height: 85vh; overflow-y: auto;">
            <span class="close-btn" onclick="closeMajorDetailModal()">&times;</span>
            <h2 id="majorDetailTitle" style="color: var(--primary); margin-bottom: 20px;">Chi tiết ngành học</h2>
            
            <div id="majorInfoSummary" style="background: #f0f7ff; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid var(--primary);">
                <!-- Detailed major info will go here -->
            </div>

            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="color: var(--primary); margin: 0;">Cấu trúc chương trình học</h3>
                <div style="font-size: 1.1rem; font-weight: bold;">
                    Tổng số tín chỉ: <span id="totalCreditsDisplayModal" style="color: var(--primary);">0</span>
                </div>
            </div>
            
            <div id="knowledgeBlocksContainerModal" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px;">
                <!-- Knowledge blocks will be rendered here -->
            </div>

            <div style="margin-top: 25px; text-align: right; border-top: 1px solid #eee; padding-top: 15px;">
                <button class="btn btn-secondary" onclick="closeMajorDetailModal()">Đóng</button>
            </div>
        </div>
    </div>

    <div id="toast"></div>
    <script src="script.js"></script>
</body>
</html>